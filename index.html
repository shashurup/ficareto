<html>
    <head>
        <title>Ficareto</title>
        <script>
         function isiOS() {
             return navigator.userAgent.match(/ipad|iphone/i);
         }
         function copyToClipboard(element) {
             if (isiOS()) {
                 element.contentEditable = true;
                 var range = document.createRange();
                 range.selectNodeContents(element);
                 var selection = window.getSelection();
                 selection.removeAllRanges();
                 selection.addRange(range);
                 element.setSelectionRange(0, 999999);
             }
             else {
                 element.select();
             }
             document.execCommand("copy");
         }
         function copyRendered() {
             input = document.getElementById('derived')
             copyToClipboard(input);
             alert("Copied");
         }
         async function derive(domain, pass) {
             te = new TextEncoder();
             baseKey = await crypto.subtle.importKey(
                 "raw",
                 te.encode(pass),
                 {name: "PBKDF2"},
                 false,
                 ["deriveKey"]);
             derivedKey = await crypto.subtle.deriveKey(
                 {name: "PBKDF2", hash: "SHA-512", salt: te.encode(domain), iterations: 42},
                 baseKey,
                 {name: "AES-CBC", length: 128},
                 true,
                 ["encrypt"]);
             result = await crypto.subtle.exportKey("raw", derivedKey);
             return btoa(String.fromCharCode.apply(null, new Uint8Array(result)));
         }
         function render_derivative() {
             domain = document.getElementById('domain').value;
             pass = document.getElementById('pass').value;
             input = document.getElementById('derived')
             derive(domain, pass).then((derived) => {
                 input = document.getElementById('derived')
                 input.value = derived;
                 document.getElementById("copybutton").focus();
             });
         }
        </script>
        <style>
         body {
             font-size: xx-large;
         }
         .source {
             font-size: xx-large;
             width: 16em;
         }
         button {
             font-size: xx-large;
         }
         .app {
             margin: 10%;
         }
        </style>
    </head>
    <body>
        <div class="app">
        Domain<br><input type="text" class="source" id="domain" autofocus/><br><br>
        Password<br><input type="password" class="source" id="pass"/><br><br>
        <button onclick="render_derivative();">Derive</button><br><br>
        <input type="text" class="source result" id="derived" readonly /><br><br>
        <button onclick="copyRendered();" id="copybutton">Copy</button>
        </div>
    </body>
</html>
